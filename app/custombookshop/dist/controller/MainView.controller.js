sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/core/syncStyleClass","sap/m/MessageToast"],function(t,o,e,i){"use strict";return t.extend("ntt.bookshop.custombookshop.controller.MainView",{onInit:function(){var t,o;this.oDataModel=this.getOwnerComponent().getModel();this.oMainModel=this.getOwnerComponent().getModel("mainModel");this.getView().setModel(this.oDataModel)},bookTableConfiguration:function(){let t=this.getView("ListAll").byId("idTblBookData").getTable();t.setMode("MultiSelect");t.attachSelectionChange(this.onTableSelection,this)},onOpenMultiEdit:function(t){o.load({name:"ntt.bookshop.custombookshop.view.fragments.MultiEditBookDialog",controller:this}).then(function(t){this.oBooksMultiEditDialog=t;this.getView().addDependent(this.oBooksMultiEditDialog);this.oBooksMultiEditDialog.setEscapeHandler(function(){this.onCloseDialog()}.bind(this));this.oBooksMultiEditDialog.getContent()[0].setContexts(this.getView().byId("idTblBookData").getTable().getSelectedContexts());e("sapUiSizeCompact",this.getView(),this.oBooksMultiEditDialog);this.oBooksMultiEditDialog.open()}.bind(this))},onBookCloseDialog:function(){this.oBooksMultiEditDialog.close();this.oBooksMultiEditDialog.destroy();this.oBooksMultiEditDialog=null},onTableSelection:function(){var t=this.getView().byId("idTblBookData").getTable().getSelectedItems();this.getView().byId("btnMultiEditBook").setEnabled(t.length>0)},onBookDialogSaveButton:function(){var t=this.oBooksMultiEditDialog.getContent()[0];this.oBooksMultiEditDialog.setBusy(true);t.getErroneousFieldsAndTokens().then(function(t){this.oBooksMultiEditDialog.setBusy(false);if(t.length===0){this._saveChanges()}}.bind(this)).catch(function(){this.oBooksMultiEditDialog.setBusy(false)}.bind(this))},_saveChanges:function(){var t=this.oBooksMultiEditDialog.getContent()[0],o=this,e,s,n,l,a;var d=function(t){var o=t.getPropertyName(),e=t.getUnitOfMeasurePropertyName();if(!t.getApplyToEmptyOnly()||!l[o]||typeof l[o]=="string"&&!l[o].trim()){a[o]=n[o]}if(t.isComposite()){if(!t.getApplyToEmptyOnly()||!l[e]){a[e]=n[e]}}};i.show("Save action started");t.getAllUpdatedContexts(true).then(function(t){i.show("Updated contexts available",{onClose:function(){debugger;e=t;for(var g=0;g<e.length;g++){s=e[g].context;n=e[g].data;l=s.getModel().getObject(s.getPath());a={};this._getFields().filter(function(t){return!t.isKeepExistingSelected()}).forEach(d);s.getModel().update(s.getPath(),a)}i.show("Model was updated");o.onBookCloseDialog()}.bind(this)})}.bind(t));this.oBooksMultiEditDialog.close()}})});